<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Biweekly Pay Calculator</title>
  <style>
    /* Basic styling to look good on iPhone */
    body { font-family: system-ui, -apple-system, Arial, sans-serif; padding: 16px; background-color: #f9f9f9; }
    h1 { font-size: 20px; margin-bottom: 8px; color: #333; }
    h2 { font-size: 16px; margin-top: 18px; margin-bottom: 4px; color: #007aff; }
    
    /* Input and Table styling */
    table { border-collapse: collapse; width: 100%; margin-top: 6px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px 6px; font-size: 14px; text-align: right; }
    th { background: #f0f0f0; font-weight: 600; }
    td:first-child, th:first-child { text-align: left; }
    
    input[type="number"] { width: 90px; font-size: 16px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; }
    input[type="date"] { padding: 6px; font-size: 16px; width: 100%; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
    
    /* Button styling */
    button { 
      margin-top: 10px; 
      padding: 10px 15px; 
      font-size: 15px; 
      background-color: #007aff; 
      color: white; 
      border: none; 
      border-radius: 6px; 
      cursor: pointer;
    }
    button:active { background-color: #005bb5; }
    
    .small { font-size: 13px; color: #666; margin-top: 6px; }
    .section { border: 1px solid #ddd; padding: 12px; margin-top: 12px; border-radius: 8px; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    
    /* Print styling */
    @media print {
      body { padding: 0; background: white; }
      .section, button, h1 { display: none; } /* Hide entry forms */
      #summarySection { display: block !important; margin: 0; border: none; box-shadow: none; }
      #summaryTable { width: 100%; font-size: 12px; }
      input { border: none; background: transparent; }
    }
  </style>
</head>
<body>

<h1>Biweekly Pay Calculator</h1>

<!-- SECTION 1: Set the Period -->
<div class="section">
  <h2>1. Select Period</h2>
  <label>Start date:
    <input type="date" id="startDate">
  </label>
  <button onclick="setBiweekly()">Set Biweekly Range</button>
  <div id="periodInfo" class="small"></div>
</div>

<!-- SECTION 2: Daily Entry -->
<div class="section">
  <h2>2. Enter Daily Sales</h2>
  <div class="small">Workers: Tammy, Linh, Van, ThuyLee, Tuyen</div>
  <label style="display:block; margin-top:10px;">Select Date to Enter:
    <input type="date" id="entryDate">
  </label>
  <button onclick="loadDay()">Load Date</button>

  <table style="margin-top:15px;">
    <thead>
      <tr>
        <th>Worker</th>
        <th>Income</th>
        <th>Work?</th>
      </tr>
    </thead>
    <tbody id="dailyRows">
      <!-- Rows are inserted here by JavaScript -->
    </tbody>
  </table>

  <div style="margin-top: 15px;">
    <label>Daily Discount:
      <input type="number" id="dailyDiscount" step="0.01" value="0">
    </label>
  </div>
  
  <div id="dailyTotals" class="small" style="font-weight:bold; margin-top:10px;"></div>
  
  <button onclick="saveDay()" style="width:100%; background-color: #34c759;">Save This Day</button>
</div>

<!-- SECTION 3: Report & W2 -->
<div class="section">
  <h2>3. Biweekly Summary</h2>
  <button onclick="generateReport()">Generate Report</button>
  
  <div id="summarySection" style="display:none; margin-top:15px;">
    <h3 style="margin:0 0 10px 0;">Pay Report</h3>
    <div id="reportPeriod" class="small" style="margin-bottom:10px;"></div>

    <table id="summaryTable">
      <thead>
        <tr>
          <th>Worker</th>
          <th>Sales</th>
          <th>Days</th>
          <th>Pay (55%)</th>
          <th>Owner (45%)</th>
          <th>$/Day</th>
          <th>W2 Input</th>
          <th>Cash</th>
        </tr>
      </thead>
      <tbody id="summaryBody"></tbody>
      <tfoot>
        <tr style="font-weight:bold; background:#eef;">
          <th>TOTAL</th>
          <th id="totSales"></th>
          <th id="totDays"></th>
          <th id="totPay"></th>
          <th id="totOwner"></th>
          <th></th>
          <th id="totW2"></th>
          <th id="totCash"></th>
        </tr>
      </tfoot>
    </table>

    <button onclick="window.print()" style="background-color: #5856d6; margin-top:20px;">Print / Save as PDF</button>
  </div>
</div>

<script>
  // -- CONFIGURATION --
  const workers = ["Tammy","Linh","Van","ThuyLee","Tuyen"];

  // Data storage: { "YYYY-MM-DD": { incomes: {name: number}, discount: number } }
  const daysData = {};

  // -- INITIALIZATION --
  function renderDailyRows() {
    const tbody = document.getElementById('dailyRows');
    tbody.innerHTML = "";
    workers.forEach(name => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="text-align:left; font-weight:500;">${name}</td>
        <td><input type="number" step="0.01" data-worker="${name}" class="incomeInput" placeholder="0"></td>
        <td class="dayCell" style="text-align:center; color:#888;">0</td>
      `;
      tbody.appendChild(tr);
    });
  }
  renderDailyRows();

  // -- FUNCTIONS --

  function setBiweekly() {
    const start = document.getElementById('startDate').value;
    if (!start) { alert("Please select a start date first."); return; }
    const sd = new Date(start);
    const ed = new Date(sd);
    ed.setDate(sd.getDate() + 13); // Add 13 days to cover a 14-day period
    const info = `Period: ${sd.toLocaleDateString()} to ${ed.toLocaleDateString()}`;
    document.getElementById('periodInfo').textContent = info;
    document.getElementById('reportPeriod').textContent = info;
  }

  function loadDay() {
    const dateStr = document.getElementById('entryDate').value;
    if (!dateStr) { alert("Please select a date to load."); return; }
    
    const day = daysData[dateStr] || { incomes: {}, discount: 0 };
    
    document.querySelectorAll('.incomeInput').forEach(inp => {
      const w = inp.dataset.worker;
      const val = day.incomes[w] != null ? day.incomes[w] : "";
      inp.value = val;
      
      // Update the "Work?" column (1 or 0)
      const dayCell = inp.parentElement.nextElementSibling;
      dayCell.textContent = parseFloat(val || "0") > 0 ? "1" : "0";
    });
    
    document.getElementById('dailyDiscount').value = day.discount || 0;
    updateDailyTotals();
  }

  function saveDay() {
    const dateStr = document.getElementById('entryDate').value;
    if (!dateStr) { alert("Please select a date."); return; }
    
    const incomes = {};
    let hasData = false;
    
    document.querySelectorAll('.incomeInput').forEach(inp => {
      const w = inp.dataset.worker;
      const v = parseFloat(inp.value || "0");
      if (v > 0) hasData = true;
      incomes[w] = v;
      
      // Update UI while saving
      const dayCell = inp.parentElement.nextElementSibling;
      dayCell.textContent = v > 0 ? "1" : "0";
    });
    
    const disc = parseFloat(document.getElementById('dailyDiscount').value || "0");
    
    // Save to memory
    if (!hasData && disc === 0) {
      delete daysData[dateStr]; // Clean up empty entries
    } else {
      daysData[dateStr] = { incomes, discount: disc };
    }
    
    updateDailyTotals();
    alert("Saved data for " + dateStr);
  }

  function updateDailyTotals() {
    let total = 0;
    document.querySelectorAll('.incomeInput').forEach(inp => {
      total += parseFloat(inp.value || "0");
    });
    const disc = parseFloat(document.getElementById('dailyDiscount').value || "0");
    const after = total - disc;
    
    document.getElementById('dailyTotals').textContent =
      `Total: $${total.toFixed(2)} | After Discount: $${after.toFixed(2)}`;
  }

  // Auto-update "Work?" column and totals as you type
  document.addEventListener('input', function(e) {
    if (e.target.classList.contains('incomeInput') || e.target.id === 'dailyDiscount') {
      if (e.target.classList.contains('incomeInput')) {
        const v = parseFloat(e.target.value || "0");
        const dayCell = e.target.parentElement.nextElementSibling;
        dayCell.textContent = v > 0 ? "1" : "0";
      }
      updateDailyTotals();
    }
  });

  function generateReport() {
    // 1. Reset totals
    const totals = {};
    const days = {};
    workers.forEach(w => { totals[w] = 0; days[w] = 0; });

    // 2. Sum up all data currently in memory
    Object.keys(daysData).forEach(dateStr => {
      const d = daysData[dateStr];
      workers.forEach(w => {
        const income = d.incomes[w] || 0;
        totals[w] += income;
        if (income > 0) days[w] += 1;
      });
    });

    // 3. Build the table
    const tbody = document.getElementById('summaryBody');
    tbody.innerHTML = "";

    let totSales = 0, totDays = 0, totPay = 0, totOwner = 0;

    workers.forEach((w, idx) => {
      const sales = totals[w];
      const dCount = days[w];
      const pay = Math.round(sales * 0.55); // Rule: 55% to worker
      const owner = sales - pay;           // Rule: 45% to owner
      const perDay = dCount > 0 ? (pay / dCount) : 0;

      totSales += sales;
      totDays += dCount;
      totPay += pay;
      totOwner += owner;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="text-align:left; font-weight:500;">${w}</td>
        <td>${sales.toFixed(2)}</td>
        <td>${dCount}</td>
        <td style="font-weight:bold; color:#007aff;">${pay.toFixed(2)}</td>
        <td style="color:#555;">${owner.toFixed(2)}</td>
        <td>${perDay.toFixed(2)}</td>
        <td><input type="number" step="0.01" value="0" class="w2Input" style="width:70px;"></td>
        <td class="cashCell" style="font-weight:bold; color:#34c759;">${pay.toFixed(2)}</td>
      `;
      tbody.appendChild(tr);
    });

    // 4. Update Footer Totals
    document.getElementById('totSales').textContent = totSales.toFixed(2);
    document.getElementById('totDays').textContent = totDays;
    document.getElementById('totPay').textContent = totPay.toFixed(2);
    document.getElementById('totOwner').textContent = totOwner.toFixed(2);
    document.getElementById('totW2').textContent = "0.00";
    document.getElementById('totCash').textContent = totPay.toFixed(2); // Initially Cash = Pay

    // 5. Show Section
    document.getElementById('summarySection').style.display = "block";

    // 6. Attach Listeners for W2 inputs to auto-calculate Cash
    tbody.querySelectorAll('.w2Input').forEach((inp, idx) => {
      inp.addEventListener('input', () => {
        const payCell = tbody.rows[idx].cells[3]; // Pay column
        const payVal = parseFloat(payCell.textContent || "0");
        const w2Val = parseFloat(inp.value || "0");
        
        // Logic: Cash = Pay - W2
        const cash = payVal - w2Val;
        
        // Update Cash cell
        const cashCell = tbody.rows[idx].querySelector('.cashCell');
        cashCell.textContent = cash.toFixed(2);

        // Re-sum W2 and Cash totals
        let sumW2 = 0, sumCash = 0;
        tbody.querySelectorAll('.w2Input').forEach((i2, j) => {
          const w2v = parseFloat(i2.value || "0");
          const cashv = parseFloat(tbody.rows[j].querySelector('.cashCell').textContent || "0");
          sumW2 += w2v;
          sumCash += cashv;
        });
        document.getElementById('totW2').textContent = sumW2.toFixed(2);
        document.getElementById('totCash').textContent = sumCash.toFixed(2);
      });
    });
  }
</script>

</body>
</html>
